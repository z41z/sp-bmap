/*! BMapLib libraries build on 2018-12-28 */

var BMapLib=window.BMapLib=BMapLib||{};!function(){var h=h||{guid:"$BAIDU$"};window[h.guid]={},h.extend=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},h.lang=h.lang||{},h.lang.guid=function(){return"TANGRAM__"+(window[h.guid]._counter++).toString(36)},window[h.guid]._counter=window[h.guid]._counter||1,window[h.guid]._instances=window[h.guid]._instances||{},h.lang.Class=function(t){this.guid=t||h.lang.guid(),window[h.guid]._instances[this.guid]=this},window[h.guid]._instances=window[h.guid]._instances||{},h.lang.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},h.lang.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},h.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"},h.lang.Class.prototype.dispose=function(){for(var t in delete window[h.guid]._instances[this.guid],this)h.lang.isFunction(this[t])||delete this[t];this.disposed=!0},h.lang.Event=function(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null},h.lang.Class.prototype.addEventListener=function(t,e,n){if(h.lang.isFunction(e)){!this.__listeners&&(this.__listeners={});var i,o=this.__listeners;if("string"==typeof n&&n){if(/[^\w\-]/.test(n))throw"nonstandard key:"+n;i=e.hashCode=n}0!=t.indexOf("on")&&(t="on"+t),"object"!=typeof o[t]&&(o[t]={}),i=i||h.lang.guid(),e.hashCode=i,o[t][i]=e}},h.lang.Class.prototype.removeEventListener=function(t,e){if(h.lang.isFunction(e))e=e.hashCode;else if(!h.lang.isString(e))return;!this.__listeners&&(this.__listeners={}),0!=t.indexOf("on")&&(t="on"+t);var n=this.__listeners;n[t]&&n[t][e]&&delete n[t][e]},h.lang.Class.prototype.dispatchEvent=function(t,e){for(var n in h.lang.isString(t)&&(t=new h.lang.Event(t)),!this.__listeners&&(this.__listeners={}),e=e||{})t[n]=e[n];var i=this.__listeners,o=t.type;if(t.target=t.target||this,t.currentTarget=this,0!=o.indexOf("on")&&(o="on"+o),h.lang.isFunction(this[o])&&this[o].apply(this,arguments),"object"==typeof i[o])for(n in i[o])i[o][n].apply(this,arguments);return t.returnValue},h.lang.inherits=function(t,e,n){var i,o,s=t.prototype,a=new Function;for(i in a.prototype=e.prototype,o=t.prototype=new a,s)o[i]=s[i];(t.prototype.constructor=t).superClass=e.prototype,"string"==typeof n&&(o._className=n)},h.dom=h.dom||{},h._g=h.dom._g=function(t){return h.lang.isString(t)?document.getElementById(t):t},h.g=h.dom.g=function(t){return"string"==typeof t||t instanceof String?document.getElementById(t):t&&t.nodeName&&(1==t.nodeType||9==t.nodeType)?t:null},h.insertHTML=h.dom.insertHTML=function(t,e,n){var i,o;return(t=h.dom.g(t)).insertAdjacentHTML?t.insertAdjacentHTML(e,n):(i=t.ownerDocument.createRange(),"AFTERBEGIN"==(e=e.toUpperCase())||"BEFOREEND"==e?(i.selectNodeContents(t),i.collapse("AFTERBEGIN"==e)):(i[(o="BEFOREBEGIN"==e)?"setStartBefore":"setEndAfter"](t),i.collapse(o)),i.insertNode(i.createContextualFragment(n))),t},h.ac=h.dom.addClass=function(t,e){t=h.dom.g(t);for(var n=e.split(/\s+/),i=t.className,o=" "+i+" ",s=0,a=n.length;s<a;s++)o.indexOf(" "+n[s]+" ")<0&&(i+=(i?" ":"")+n[s]);return t.className=i,t},h.event=h.event||{},h.event._listeners=h.event._listeners||[],h.on=h.event.on=function(e,t,n){t=t.replace(/^on/i,""),e=h._g(e);var i,o=function(t){n.call(e,t)},s=h.event._listeners,a=h.event._eventFilter,r=t;return t=t.toLowerCase(),a&&a[t]&&(r=(i=a[t](e,t,o)).type,o=i.listener),e.addEventListener?e.addEventListener(r,o,!1):e.attachEvent&&e.attachEvent("on"+r,o),s[s.length]=[e,t,n,o,r],e},h.un=h.event.un=function(t,e,n){t=h._g(t),e=e.replace(/^on/i,"").toLowerCase();for(var i,o,s,a=h.event._listeners,r=a.length,l=!n;r--;)(i=a[r])[1]!==e||i[0]!==t||!l&&i[2]!==n||(o=i[4],s=i[3],t.removeEventListener?t.removeEventListener(o,s,!1):t.detachEvent&&t.detachEvent("on"+o,s),a.splice(r,1));return t},h.preventDefault=h.event.preventDefault=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1};var t=BMapLib.DistanceTool=function(t,e){t&&(this._map=t,e=e||{},this._opts=h.extend(h.extend(this._opts||{},{tips:"测距",followText:"单击确定地点，双击结束",unit:"metric",lineColor:"#ff6319",lineStroke:2,opacity:.8,lineStyle:"solid",cursor:"http://api.map.baidu.com/images/ruler.cur",secIcon:null,closeIcon:null}),e),this._followTitle=null,this._points=[],this._paths=[],this._dots=[],this._segDistance=[],this._overlays=[],this._enableMassClear=!0,this._units={metric:{name:"metric",conv:1,incon:1e3,u1:"米",u2:"公里"},us:{name:"us",conv:3.2808,incon:5279.856,u1:"英尺",u2:"英里"}},this._isOpen=!1,this._startFollowText="单击确定起点",this._movingTimerId=null,this._styles={BMapLib_diso:"height:17px;width:5px;position:absolute;background:url(http://api.map.baidu.com/images/dis_box_01.gif) no-repeat left top",BMapLib_disi:"color:#7a7a7a;position:absolute;left:5px;padding:0 4px 1px 0;line-height:17px;background:url(http://api.map.baidu.com/images/dis_box_01.gif) no-repeat right top",BMapLib_disBoxDis:"color:#ff6319;font-weight:bold"},this._opts.lineStroke<=0&&(this._opts.lineStroke=2),1<this._opts.opacity?this._opts.opacity=1:this._opts.opacity<0&&(this._opts.opacity=0),"solid"!=this._opts.lineStyle&&"dashed"!=this._opts.lineStyle&&(this._opts.lineStyle="solid"),this._units[this._opts.unit]||(this._opts.unit="metric"),this.text="测距")};h.lang.inherits(t,h.lang.Class,"DistanceTool"),t.prototype._bind=function(){this._setCursor(this._opts.cursor);var n=this;if(h.on(this._map.getContainer(),"mousemove",function(t){if(n._isOpen&&n._followTitle)if(((t=window.event||t).target||t.srcElement)==g.getDom(n._map)){n._mapMoving||n._followTitle.show();var e=g.getDrawPoint(t,!0);n._followTitle.setPosition(e)}else n._followTitle.hide()}),this._startFollowText){this._followTitle=new BMap.Label(this._startFollowText,{offset:new BMap.Size(14,16)});this._followTitle.setStyles({color:"#333",borderColor:"#ff0103"})}},t.prototype.open=function(){if(1==this._isOpen)return!0;if(!BMapLib._toolInUse){this._isOpen=!0,BMapLib._toolInUse=!0,this._mapMoving&&delete this._mapMoving;var c=this;this._binded||(this._binded=!0,this._bind(),this._map.addEventListener("moving",function(){c._hideCurrent()})),this._followTitle&&(this._map.addOverlay(this._followTitle),this._followTitle.hide());var e=function(t){var e=c._map;if(c._isOpen){t=window.event||t;var n=g.getDrawPoint(t,!0);if(c._isPointValid(n)){if(c._bind.initX=t.pageX||t.clientX||0,c._bind.initY=t.pageY||t.clientY||0,0<c._points.length){var i=e.pointToPixel(c._points[c._points.length-1]),o=e.pointToPixel(n);if(Math.sqrt(Math.pow(i.x-o.x,2)+Math.pow(i.y-o.y,2))<5)return}c._bind.x=t.layerX||t.offsetX||0,c._bind.y=t.layerY||t.offsetY||0,c._points.push(n),c._addSecPoint(n),0==c._paths.length&&c._formatTitle(1,c._opts.followText,c._getTotalDistance()),0<c._paths.length&&(c._paths[c._paths.length-1].show(),c._paths[c._paths.length-1].setStrokeOpacity(c._opts.opacity));var s=new BMap.Polyline([n,n],{enableMassClear:c._enableMassClear});if(c._map.addOverlay(s),c._paths.push(s),c._overlays.push(s),s.setStrokeWeight(c._opts.lineStroke),s.setStrokeColor(c._opts.lineColor),s.setStrokeOpacity(c._opts.opacity/2),s.setStrokeStyle(c._opts.lineStyle),c._mapMoving&&s.hide(),1<c._points.length)c._paths[c._points.length-2].setPositionAt(1,n);var a="";if(1<c._points.length){c._setSegDistance(c._points[c._points.length-2],c._points[c._points.length-1]);var r=c._getTotalDistance();a=c._formatDisStr(r)}else a="起点";var l=new BMap.Label(a,{offset:new BMap.Size(10,-5),enableMassClear:c._enableMassClear});l.setStyles({color:"#333",borderColor:"#ff0103"}),c._map.addOverlay(l),c._formatSegLabel(l,a),c._overlays.push(l),(n.disLabel=l).setPosition(n);var p=new h.lang.Event("onaddpoint");p.point=n,p.pixel=c._map.pointToPixel(n),p.index=c._points.length-1,p.distance=c._getTotalDistance().toFixed(0),c.dispatchEvent(p)}}},u=function(t){if(c._isOpen)if(0<c._paths.length){var e=(t=window.event||t).pageX||t.clientX||0,n=t.pageY||t.clientY||0;void 0===c._bind.initX&&(c._bind.x=t.layerX||t.offsetX||0,c._bind.y=t.layerY||t.offsetY||0,c._bind.initX=e,c._bind.initY=n);var i=c._bind.x+e-c._bind.initX,o=c._bind.y+n-c._bind.initY,s=c._paths[c._paths.length-1],a=c._map.pixelToPoint(new BMap.Pixel(i,o));s.setPositionAt(1,a),c._mapMoving||s.show();var r=0,l=0;if(i<10?r=8:i>c._map.getSize().width-10&&(r=-8),o<10?l=8:o>c._map.getSize().height-10&&(l=-8),0!=r||0!=l)u._movingTimerId||(c._mapMoving=!0,c._map.panBy(r,l,{noAnimation:!0}),c._movingTimerId=u._movingTimerId=setInterval(function(){c._map.panBy(r,l,{noAnimation:!0})},30),s.hide(),c._followTitle&&c._followTitle.hide());else if(u._movingTimerId){clearInterval(u._movingTimerId),delete u._movingTimerId,delete c._movingTimerId;var p=c._paths[c._paths.length-1],h=c._map.pixelToPoint(new BMap.Pixel(i,o));if(!p)return;p.setPositionAt(1,h),p.show(),c._followTitle&&(c._followTitle.setPosition(h),c._followTitle.show()),c._bind.i=0,c._bind.j=0,delete c._mapMoving}if(c._followTitle){var _=c._getTotalDistance(),d=c._map.getDistance(c._points[c._points.length-1],a);c._updateInstDis(c._followTitle,_+d)}}else{if(c._followTitle)c._followTitle.show(),((t=window.event||t).target||t.srcElement)!=g.getDom()&&c._followTitle.hide()}},n=function(t){c._isOpen&&(h.un(g.getDom(c._map),"click",e),h.un(document,"mousemove",u),h.un(g.getDom(c._map),"dblclick",n),h.un(document,"keydown",i),h.un(g.getDom(c._map),"mouseup",o),setTimeout(function(){c.close()},50))},i=function(t){27==(t=window.event||t).keyCode&&(c._clearCurData(),setTimeout(function(){c.close()},50))},o=function(t){t=window.event||t;var e=0;/msie (\d+\.\d)/i.test(navigator.userAgent)&&(e=document.documentMode||+RegExp.$1),(e&&1!=t.button||2==t.button)&&c.close()};return c._initData(),this._formatTitle(),g.show(this._map),this._setCursor(this._opts.cursor),h.on(g.getDom(this._map),"click",e),h.on(document,"mousemove",u),h.on(g.getDom(this._map),"dblclick",n),h.on(document,"keydown",i),h.on(g.getDom(this._map),"mouseup",o),this.bindFunc=[{elem:g.getDom(this._map),type:"click",func:e},{elem:g.getDom(this._map),type:"dblclick",func:n},{elem:document,type:"mousemove",func:u},{elem:document,type:"keydown",func:i},{elem:g.getDom(this._map),type:"mouseup",func:o}],!0}},t.prototype._dispatchLastEvent=function(){var t=new h.lang.Event("ondrawend");t.points=this._points?this._points.slice(0):[],t.overlays=this._paths?this._paths.slice(0,this._paths.length-1):[],t.distance=this._getTotalDistance().toFixed(0),this.dispatchEvent(t)},t.prototype.close=function(){if(0!=this._isOpen){this._isOpen=!1,BMapLib._toolInUse=!1,this._mapMoving&&delete this._mapMoving;var t=this;if(t._dispatchLastEvent(),t._points.length<2)t._clearCurData();else{t._paths[t._paths.length-1].remove(),t._paths[t._paths.length-1]=null,t._paths.length=t._paths.length-1;var e=t._points[t._points.length-1];e.disLabel&&e.disLabel.remove(),t._processLastOp()}g.hide();for(var n=0,i=this.bindFunc.length;n<i;n++)h.un(this.bindFunc[n].elem,this.bindFunc[n].type,this.bindFunc[n].func);t._movingTimerId&&(clearInterval(t._movingTimerId),t._movingTimerId=null),this._followTitle&&this._followTitle.hide()}},t.prototype._clearCurData=function(){for(var t=0,e=this._points.length;t<e;t++)this._points[t].disLabel&&this._points[t].disLabel.remove();for(t=0,e=this._paths.length;t<e;t++)this._paths[t].remove();for(t=0,e=this._dots.length;t<e;t++)this._dots[t].remove();this._initData()},t.prototype._initData=function(){this._points.length=0,this._paths.length=0,this._segDistance.length=0,this._dots.length=0},t.prototype._setSegDistance=function(t,e){if(t&&e){var n=this._map.getDistance(t,e);return this._segDistance.push(n),n}},t.prototype._getTotalDistance=function(){for(var t=0,e=0,n=this._segDistance.length;e<n;e++)t+=this._segDistance[e];return t},t.prototype._convertUnit=function(t,e){return e=e||"metric",this._units[e]?t*this._units[e].conv:t},t.prototype._addSecPoint=function(t){var e=this._opts.secIcon?this._opts.secIcon:new BMap.Icon("http://api.map.baidu.com/images/mapctrls.png",new BMap.Size(11,11),{imageOffset:new BMap.Size(-26,-313)}),n=new BMap.Marker(t,{icon:e,clickable:!1,baseZIndex:35e5,zIndexFixed:!0,enableMassClear:this._enableMassClear});this._map.addOverlay(n),this._dots.push(n)},t.prototype._formatDisStr=function(t){var e=this._opts.unit,n=this._units[e].u1,i=this._convertUnit(t,e);return(i=i>this._units[e].incon?(i/=this._units[e].incon,n=this._units[e].u2,i.toFixed(1)):i.toFixed(0))+n},t.prototype._setCursor=function(t){var e=/webkit/.test(navigator.userAgent.toLowerCase())?"url("+this._opts.cursor+") 3 6, crosshair":"url("+this._opts.cursor+"), crosshair";g._setCursor(e)},t.prototype._getCursor=function(){return this._opts.cursor},t.prototype._formatSegLabel=function(t,e){t.setStyle({border:"none",padding:"0"}),t.setContent("<span style='"+this._styles.BMapLib_diso+"'><span style='"+this._styles.BMapLib_disi+"'>"+e+"</span></span>")},t.prototype._processLastOp=function(){var o=this;if(delete o._bind.x,delete o._bind.y,delete o._bind.initX,delete o._bind.initY,o._paths.length>o._points.length-1){var t=o._paths.length-1;o._paths[t].remove(),o._paths[t]=null,o._paths.length=t}var s={};s.points=o._points.slice(0),s.paths=o._paths.slice(0),s.dots=o._dots.slice(0),s.segDis=o._segDistance.slice(0);var e=o._map.pointToPixel(s.points[s.points.length-1]),n=o._map.pointToPixel(s.points[s.points.length-2]),i=[0,0],a=[0,0];a=0<=e.y-n.y?[-5,11]:[-5,-35],i=0<=e.x-n.x?[14,0]:[-14,0];var r=s.points[s.points.length-1];r.disLabel=new BMap.Label("",{offset:new BMap.Size(-15,-40),enableMassClear:o._enableMassClear}),r.disLabel.setStyles({color:"#333",borderColor:"#ff0103"}),o._map.addOverlay(r.disLabel),r.disLabel.setOffset(new BMap.Size(a[0],a[1])),r.disLabel.setPosition(r),o._formatTitle(2,"","",r.disLabel);var l=this._opts.closeIcon?this._opts.closeIcon:new BMap.Icon("http://api.map.baidu.com/images/mapctrls.gif",new BMap.Size(12,12),{imageOffset:new BMap.Size(0,-14)});s.closeBtn=new BMap.Marker(s.points[s.points.length-1],{icon:l,offset:new BMap.Size(i[0],i[1]),baseZIndex:36e5,enableMassClear:o._enableMassClear}),o._map.addOverlay(s.closeBtn),s.closeBtn.setTitle("清除本次测距"),s.closeBtn.addEventListener("click",function(t){for(var e=0,n=s.points.length;e<n;e++)s.points[e].disLabel.remove(),s.points[e].disLabel=null;for(e=0,n=s.paths.length;e<n;e++)s.paths[e].remove(),s.paths[e]=null;for(e=0,n=s.dots.length;e<n;e++)s.dots[e].remove(),s.dots[e]=null;s.closeBtn.remove(),s.closeBtn=null,p(t);var i=new h.lang.Event("onremovepolyline");o.dispatchEvent(i)}),o._initData()},t.prototype._formatTitle=function(t,e,n,i){var o=i||this._followTitle;if(o){o.setStyle({lineHeight:"16px",zIndex:"85",padding:"3px 5px"});var s=this._startFollowText||"",a=[];if(1==t){o.setOffset(0,25);var r=this._opts.unit,l=this._units[r].u1;p=(p=this._convertUnit(n,r))>this._units[r].incon?(p/=this._units[r].incon,l=this._units[r].u2,p.toFixed(1)):p.toFixed(0),a.push("<span>总长：<span style='"+this._styles.BMapLib_disBoxDis+"'>"+p+"</span>"+l+"</span><br />"),a.push("<span style='color:#7a7a7a'>"+e+"</span>")}else if(2==t){var p;r=this._opts.unit,l=this._units[r].u1;p=(p=this._convertUnit(this._getTotalDistance(),r))>this._units[r].incon?(p/=this._units[r].incon,l=this._units[r].u2,p.toFixed(1)):p.toFixed(0),a.push("总长：<span style='"+this._styles.BMapLib_disBoxDis+"'>"+p+"</span>"+l)}else o.setOffset(0,25),a.push(s);o.setContent(a.join(""))}},t.prototype._updateInstDis=function(t,e){var n=this._opts.unit,i=this._units[n].u1;if(e=e>this._units[n].incon?(e/=this._units[n].incon,i=this._units[n].u2,e.toFixed(1)):e.toFixed(0),t){var o=[];o.push("<span>总长：<span style='"+this._styles.BMapLib_disBoxDis+"'>"+e+"</span>"+i+"</span><br />"),o.push("<span style='color:#7a7a7a'>"+this._opts.followText+"</span>"),t.setContent(o.join(""))}},t.prototype._hideCurrent=function(){if(this._isOpen){if(0<this._paths.length)this._paths[this._paths.length-1].hide();this._followTitle&&this._followTitle.hide()}};var g={_map:null,_html:"<div style='background:transparent url(http://api.map.baidu.com/images/blank.gif);position:absolute;left:0;top:0;width:100%;height:100%;z-index:1000' unselectable='on'></div>",_maskElement:null,_cursor:"default",_inUse:!(t.prototype._isPointValid=function(t){if(!t)return!1;var e=this._map.getBounds(),n=e.getSouthWest(),i=e.getNorthEast();return!(t.lng<n.lng||t.lng>i.lng||t.lat<n.lat||t.lat>i.lat)}),show:function(t){this._map||(this._map=t),this._inUse=!0,this._maskElement||this._createMask(t),this._maskElement.style.display="block"},_createMask:function(t){if(this._map=t,this._map){h.insertHTML(this._map.getContainer(),"beforeEnd",this._html);var e=this._maskElement=this._map.getContainer().lastChild,n=function(t){return p(t),h.preventDefault(t)};h.on(e,"mouseup",function(t){2==t.button&&n(t)}),h.on(e,"contextmenu",n),e.style.display="none"}},getDrawPoint:function(t,e){var n=(t=window.event||t).layerX||t.offsetX||0,i=t.layerY||t.offsetY||0,o=t.target||t.srcElement;if(o!=g.getDom(this._map)&&1==e)for(;o&&o!=this._map.getContainer();)0==o.clientWidth&&0==o.clientHeight&&o.offsetParent&&"td"==o.offsetParent.nodeName.toLowerCase()||(n+=o.offsetLeft,i+=o.offsetTop),o=o.offsetParent;if(!(o!=g.getDom(this._map)&&o!=this._map.getContainer()||void 0===n||void 0===i||isNaN(n)||isNaN(i)))return this._map.pixelToPoint(new BMap.Pixel(n,i))},hide:function(){this._map&&(this._inUse=!1,this._maskElement&&(this._maskElement.style.display="none"))},getDom:function(t){return this._maskElement||this._createMask(t),this._maskElement},_setCursor:function(t){this._cursor=t||"default",this._maskElement&&(this._maskElement.style.cursor=this._cursor)}};function p(t){(t=window.event||t).stopPropagation?t.stopPropagation():t.cancelBubble=!0}}();BMapLib=window.BMapLib=BMapLib||{};var BMAP_DRAWING_MARKER="marker",BMAP_DRAWING_POLYLINE="polyline",BMAP_DRAWING_CIRCLE="circle",BMAP_DRAWING_RECTANGLE="rectangle",BMAP_DRAWING_POLYGON="polygon";!function(){var p=p||{guid:"$BAIDU$"};window[p.guid]={},p.extend=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},p.lang=p.lang||{},p.lang.guid=function(){return"TANGRAM__"+(window[p.guid]._counter++).toString(36)},window[p.guid]._counter=window[p.guid]._counter||1,window[p.guid]._instances=window[p.guid]._instances||{},p.lang.Class=function(t){this.guid=t||p.lang.guid(),window[p.guid]._instances[this.guid]=this},window[p.guid]._instances=window[p.guid]._instances||{},p.lang.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},p.lang.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},p.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"},p.lang.Class.prototype.dispose=function(){for(var t in delete window[p.guid]._instances[this.guid],this)p.lang.isFunction(this[t])||delete this[t];this.disposed=!0},p.lang.Event=function(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null},p.lang.Class.prototype.addEventListener=function(t,e,n){if(p.lang.isFunction(e)){!this.__listeners&&(this.__listeners={});var i,o=this.__listeners;if("string"==typeof n&&n){if(/[^\w\-]/.test(n))throw"nonstandard key:"+n;i=e.hashCode=n}0!=t.indexOf("on")&&(t="on"+t),"object"!=typeof o[t]&&(o[t]={}),i=i||p.lang.guid(),e.hashCode=i,o[t][i]=e}},p.lang.Class.prototype.removeEventListener=function(t,e){if(p.lang.isFunction(e))e=e.hashCode;else if(!p.lang.isString(e))return;!this.__listeners&&(this.__listeners={}),0!=t.indexOf("on")&&(t="on"+t);var n=this.__listeners;n[t]&&n[t][e]&&delete n[t][e]},p.lang.Class.prototype.dispatchEvent=function(t,e){for(var n in p.lang.isString(t)&&(t=new p.lang.Event(t)),!this.__listeners&&(this.__listeners={}),e=e||{})t[n]=e[n];var i=this.__listeners,o=t.type;if(t.target=t.target||this,t.currentTarget=this,0!=o.indexOf("on")&&(o="on"+o),p.lang.isFunction(this[o])&&this[o].apply(this,arguments),"object"==typeof i[o])for(n in i[o])i[o][n].apply(this,arguments);return t.returnValue},p.lang.inherits=function(t,e,n){var i,o,s=t.prototype,a=new Function;for(i in a.prototype=e.prototype,o=t.prototype=new a,s)o[i]=s[i];(t.prototype.constructor=t).superClass=e.prototype,"string"==typeof n&&(o._className=n)},p.dom=p.dom||{},p._g=p.dom._g=function(t){return p.lang.isString(t)?document.getElementById(t):t},p.g=p.dom.g=function(t){return"string"==typeof t||t instanceof String?document.getElementById(t):t&&t.nodeName&&(1==t.nodeType||9==t.nodeType)?t:null},p.insertHTML=p.dom.insertHTML=function(t,e,n){var i,o;return(t=p.dom.g(t)).insertAdjacentHTML?t.insertAdjacentHTML(e,n):(i=t.ownerDocument.createRange(),"AFTERBEGIN"==(e=e.toUpperCase())||"BEFOREEND"==e?(i.selectNodeContents(t),i.collapse("AFTERBEGIN"==e)):(i[(o="BEFOREBEGIN"==e)?"setStartBefore":"setEndAfter"](t),i.collapse(o)),i.insertNode(i.createContextualFragment(n))),t},p.ac=p.dom.addClass=function(t,e){t=p.dom.g(t);for(var n=e.split(/\s+/),i=t.className,o=" "+i+" ",s=0,a=n.length;s<a;s++)o.indexOf(" "+n[s]+" ")<0&&(i+=(i?" ":"")+n[s]);return t.className=i,t},p.event=p.event||{},p.event._listeners=p.event._listeners||[],p.on=p.event.on=function(e,t,n){t=t.replace(/^on/i,""),e=p._g(e);var i,o=function(t){n.call(e,t)},s=p.event._listeners,a=p.event._eventFilter,r=t;return t=t.toLowerCase(),a&&a[t]&&(r=(i=a[t](e,t,o)).type,o=i.listener),e.addEventListener?e.addEventListener(r,o,!1):e.attachEvent&&e.attachEvent("on"+r,o),s[s.length]=[e,t,n,o,r],e},p.un=p.event.un=function(t,e,n){t=p._g(t),e=e.replace(/^on/i,"").toLowerCase();for(var i,o,s,a=p.event._listeners,r=a.length,l=!n;r--;)(i=a[r])[1]!==e||i[0]!==t||!l&&i[2]!==n||(o=i[4],s=i[3],t.removeEventListener?t.removeEventListener(o,s,!1):t.detachEvent&&t.detachEvent("on"+o,s),a.splice(r,1));return t},p.getEvent=p.event.getEvent=function(t){return window.event||t},p.getTarget=p.event.getTarget=function(t){return(t=p.getEvent(t)).target||t.srcElement},p.preventDefault=p.event.preventDefault=function(t){(t=p.getEvent(t)).preventDefault?t.preventDefault():t.returnValue=!1},p.stopBubble=p.event.stopBubble=function(t){(t=p.getEvent(t)).stopPropagation?t.stopPropagation():t.cancelBubble=!0},p.browser=p.browser||{},/msie (\d+\.\d)/i.test(navigator.userAgent)&&(p.browser.ie=p.ie=document.documentMode||+RegExp.$1);var t=BMapLib.DrawingManager=function(t,e){t&&(n.push(this),e=e||{},this._initialize(t,e))};function e(){this._enableEdgeMove=!1}function i(t,e){this.drawingManager=t,e=this.drawingToolOptions=e||{},this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT,this.defaultOffset=new BMap.Size(10,10),this.defaultDrawingModes=[BMAP_DRAWING_MARKER,BMAP_DRAWING_CIRCLE,BMAP_DRAWING_POLYLINE,BMAP_DRAWING_POLYGON,BMAP_DRAWING_RECTANGLE],e.drawingModes?this.drawingModes=e.drawingModes:this.drawingModes=this.defaultDrawingModes,e.anchor&&this.setAnchor(e.anchor),e.offset&&this.setOffset(e.offset)}p.lang.inherits(t,p.lang.Class,"DrawingManager"),t.prototype.open=function(){if(1==this._isOpen)return!0;o(this),this._open()},t.prototype.close=function(){if(0==this._isOpen)return!0;var t=this;this._close(),setTimeout(function(){t._map.enableDoubleClickZoom()},2e3)},t.prototype.setDrawingMode=function(t){this._drawingType!=t&&(o(this),this._setDrawingMode(t))},t.prototype.getDrawingMode=function(){return this._drawingType},t.prototype.enableCalculate=function(){this._enableCalculate=!0,this._addGeoUtilsLibrary()},t.prototype.disableCalculate=function(){this._enableCalculate=!1},t.prototype._initialize=function(t,e){if(this._map=t,this._opts=e,this._drawingType=e.drawingMode||BMAP_DRAWING_MARKER,e.enableDrawingTool){var n=new i(this,e.drawingToolOptions);this._drawingTool=n,t.addControl(n)}!0===e.enableCalculate?this.enableCalculate():this.disableCalculate(),this._isOpen=!(!0!==e.isOpen),this._isOpen&&this._open(),this.markerOptions=e.markerOptions||{},this.circleOptions=e.circleOptions||{},this.polylineOptions=e.polylineOptions||{},this.polygonOptions=e.polygonOptions||{},this.rectangleOptions=e.rectangleOptions||{},this.controlButton="right"==e.controlButton?"right":"left"},t.prototype._open=function(){this._isOpen=!0,this._mask||(this._mask=new e),this._map.addOverlay(this._mask),this._setDrawingMode(this._drawingType)},t.prototype._setDrawingMode=function(t){if(this._drawingType=t,this._isOpen)switch(this._mask.__listeners={},t){case BMAP_DRAWING_MARKER:this._bindMarker();break;case BMAP_DRAWING_CIRCLE:this._bindCircle();break;case BMAP_DRAWING_POLYLINE:case BMAP_DRAWING_POLYGON:this._bindPolylineOrPolygon();break;case BMAP_DRAWING_RECTANGLE:this._bindRectangle()}this._drawingTool&&this._isOpen&&this._drawingTool.setStyleByDrawingMode(t)},t.prototype._close=function(){this._isOpen=!1,this._mask&&this._map.removeOverlay(this._mask),this._drawingTool&&this._drawingTool.setStyleByDrawingMode("hander")},t.prototype._bindMarker=function(){var n=this,i=this._map;this._mask.addEventListener("click",function(t){var e=new BMap.Marker(t.point,n.markerOptions);i.addOverlay(e),n._dispatchOverlayComplete(e)})},t.prototype._bindCircle=function(){var n=this,i=this._map,o=this._mask,s=null,a=null,r=function(t){s.setRadius(n._map.getDistance(a,t.point))},l=function(t){var e=n._calculate(s,t.point);n._dispatchOverlayComplete(s,e),a=null,o.disableEdgeMove(),o.removeEventListener("mousemove",r),p.un(document,"mouseup",l)};o.addEventListener("mousedown",function(t){var e;p.preventDefault(t),p.stopBubble(t),("right"!=n.controlButton||1!=t.button)&&null==a&&(e=t,("right"!=n.controlButton||1!=e.button&&0!=e.button)&&(a=e.point,s=new BMap.Circle(a,0,n.circleOptions),i.addOverlay(s),o.enableEdgeMove(),o.addEventListener("mousemove",r),p.on(document,"mouseup",l)))})},t.prototype._bindPolylineOrPolygon=function(){var n=this,e=this._map,i=this._mask,o=[],s=null;overlay=null,isBinded=!1;var a=function(t){("right"!=n.controlButton||1!=t.button&&0!=t.button)&&(o.push(t.point),s=o.concat(o[o.length-1]),1==o.length?(n._drawingType==BMAP_DRAWING_POLYLINE?overlay=new BMap.Polyline(s,n.polylineOptions):n._drawingType==BMAP_DRAWING_POLYGON&&(overlay=new BMap.Polygon(s,n.polygonOptions)),e.addOverlay(overlay)):overlay.setPath(s),isBinded||(isBinded=!0,i.enableEdgeMove(),i.addEventListener("mousemove",r),i.addEventListener("dblclick",l)))},r=function(t){overlay.setPositionAt(s.length-1,t.point)},l=function(t){p.stopBubble(t),isBinded=!1,i.disableEdgeMove(),i.removeEventListener("mousedown",a),i.removeEventListener("mousemove",r),i.removeEventListener("dblclick",l),"right"==n.controlButton?o.push(t.point):p.ie<=8||o.pop(),overlay.setPath(o);var e=n._calculate(overlay,o.pop());n._dispatchOverlayComplete(overlay,e),o.length=0,s.length=0,n.close()};i.addEventListener("mousedown",a),i.addEventListener("dblclick",function(t){p.stopBubble(t)})},t.prototype._bindRectangle=function(){var n=this,i=this._map,o=this._mask,s=null,a=null,r=function(t){s.setPath(n._getRectanglePoint(a,t.point))},l=function(t){var e=n._calculate(s,s.getPath()[2]);n._dispatchOverlayComplete(s,e),a=null,o.disableEdgeMove(),o.removeEventListener("mousemove",r),p.un(document,"mouseup",l)};o.addEventListener("mousedown",function(t){if(p.stopBubble(t),p.preventDefault(t),"right"!=n.controlButton||1!=t.button&&0!=t.button){var e=a=t.point;s=new BMap.Polygon(n._getRectanglePoint(a,e),n.rectangleOptions),i.addOverlay(s),o.enableEdgeMove(),o.addEventListener("mousemove",r),p.on(document,"mouseup",l)}})},t.prototype._calculate=function(t,e){var n={data:0,label:null};if(this._enableCalculate&&BMapLib.GeoUtils){switch(t.toString()){case"[object Polyline]":n.data=BMapLib.GeoUtils.getPolylineDistance(t);break;case"[object Polygon]":n.data=BMapLib.GeoUtils.getPolygonArea(t);break;case"[object Circle]":var i=t.getRadius();n.data=Math.PI*i*i}!n.data||n.data<0?n.data=0:n.data=n.data.toFixed(2),n.label=this._addLabel(e,n.data)}return n},t.prototype._addGeoUtilsLibrary=function(){if(!BMapLib.GeoUtils){var t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src","http://api.map.baidu.com/library/GeoUtils/1.2/src/GeoUtils_min.js"),document.body.appendChild(t)}},t.prototype._addLabel=function(t,e){var n=new BMap.Label(e,{position:t});return this._map.addOverlay(n),n},t.prototype._getRectanglePoint=function(t,e){return[new BMap.Point(t.lng,t.lat),new BMap.Point(e.lng,t.lat),new BMap.Point(e.lng,e.lat),new BMap.Point(t.lng,e.lat)]},t.prototype._dispatchOverlayComplete=function(t,e){var n={overlay:t,drawingMode:this._drawingType};e&&(n.calculate=e.data||null,n.label=e.label||null),this.dispatchEvent(this._drawingType+"complete",t),this.dispatchEvent("overlaycomplete",n)},(e.prototype=new BMap.Overlay).dispatchEvent=p.lang.Class.prototype.dispatchEvent,e.prototype.addEventListener=p.lang.Class.prototype.addEventListener,e.prototype.removeEventListener=p.lang.Class.prototype.removeEventListener,e.prototype.initialize=function(t){var e=this;this._map=t;var n=this.container=document.createElement("div"),i=this._map.getSize();return n.style.cssText="position:absolute;background:url(about:blank);cursor:crosshair;width:"+i.width+"px;height:"+i.height+"px",this._map.addEventListener("resize",function(t){e._adjustSize(t.size)}),this._map.getPanes().floatPane.appendChild(n),this._bind(),n},e.prototype.draw=function(){var t=this._map,e=t.pixelToPoint(new BMap.Pixel(0,0)),n=t.pointToOverlayPixel(e);this.container.style.left=n.x+"px",this.container.style.top=n.y+"px"},e.prototype.enableEdgeMove=function(){this._enableEdgeMove=!0},e.prototype.disableEdgeMove=function(){clearInterval(this._edgeMoveTimer),this._enableEdgeMove=!1},e.prototype._bind=function(){for(var o=this,t=(this._map,this.container),s=null,a=null,r=function(t){return{x:t.clientX,y:t.clientY}},e=function(e){var t=e.type;e=p.getEvent(e),point=o.getDrawPoint(e);var n=function(t){e.point=point,o.dispatchEvent(e)};"mousedown"==t&&(s=r(e));var i=r(e);"click"==t?Math.abs(i.x-s.x)<5&&Math.abs(i.y-s.y)<5&&(a=a&&Math.abs(i.x-a.x)<5&&Math.abs(i.y-a.y)<5?null:(n(),r(e))):n()},n=["click","mousedown","mousemove","mouseup","dblclick"],i=n.length;i--;)p.on(t,n[i],e);p.on(t,"mousemove",function(t){o._enableEdgeMove&&o.mousemoveAction(t)})},e.prototype.mousemoveAction=function(t){var e,n,i,o=this._map,s=this,a=o.pointToPixel(this.getDrawPoint(t)),r=(n=(e=t).clientX,i=e.clientY,e.changedTouches&&(n=e.changedTouches[0].clientX,i=e.changedTouches[0].clientY),new BMap.Pixel(n,i)),l=r.x-a.x,p=r.y-a.y;a=new BMap.Pixel(r.x-l,r.y-p);this._draggingMovePixel=a,o.pixelToPoint(a);this._panByX=this._panByY=0,a.x<=20||a.x>=o.width-20||a.y<=50||a.y>=o.height-10?(a.x<=20?this._panByX=8:a.x>=o.width-20&&(this._panByX=-8),a.y<=50?this._panByY=8:a.y>=o.height-10&&(this._panByY=-8),this._edgeMoveTimer||(this._edgeMoveTimer=setInterval(function(){o.panBy(s._panByX,s._panByY,{noAnimation:!0})},30))):this._edgeMoveTimer&&(clearInterval(this._edgeMoveTimer),this._edgeMoveTimer=null)},e.prototype._adjustSize=function(t){this.container.style.width=t.width+"px",this.container.style.height=t.height+"px"},e.prototype.getDrawPoint=function(t){var e=this._map,n=p.getTarget(t),i=t.offsetX||t.layerX||0,o=t.offsetY||t.layerY||0;for(1!=n.nodeType&&(n=n.parentNode);n&&n!=e.getContainer();)0==n.clientWidth&&0==n.clientHeight&&n.offsetParent&&"TD"==n.offsetParent.nodeName||(i+=n.offsetLeft||0,o+=n.offsetTop||0),n=n.offsetParent;var s=new BMap.Pixel(i,o);return e.pixelToPoint(s)},(i.prototype=new BMap.Control).initialize=function(t){var e=this.container=document.createElement("div");e.className="BMapLib_Drawing";var n=this.panel=document.createElement("div");return n.className="BMapLib_Drawing_panel",this.drawingToolOptions&&this.drawingToolOptions.scale&&this._setScale(this.drawingToolOptions.scale),e.appendChild(n),n.innerHTML=this._generalHtml(),this._bind(n),t.getContainer().appendChild(e),e},i.prototype._generalHtml=function(t){var n={hander:"拖动地图"};n[BMAP_DRAWING_MARKER]="画点",n[BMAP_DRAWING_CIRCLE]="画圆",n[BMAP_DRAWING_POLYLINE]="画折线",n[BMAP_DRAWING_POLYGON]="画多边形",n[BMAP_DRAWING_RECTANGLE]="画矩形";var e=function(t,e){return'<a class="'+t+'" drawingType="'+e+'" href="javascript:void(0)" title="'+n[e]+'" onfocus="this.blur()"></a>'},i=[];i.push(e("BMapLib_box BMapLib_hander","hander"));for(var o=0,s=this.drawingModes.length;o<s;o++){var a="BMapLib_box BMapLib_"+this.drawingModes[o];o==s-1&&(a+=" BMapLib_last"),i.push(e(a,this.drawingModes[o]))}return i.join("")},i.prototype._setScale=function(t){var e=-parseInt((390-390*t)/2,10),n=-parseInt((50-50*t)/2,10);this.container.style.cssText=["-moz-transform: scale("+t+");","-o-transform: scale("+t+");","-webkit-transform: scale("+t+");","transform: scale("+t+");","margin-left:"+e+"px;","margin-top:"+n+"px;","*margin-left:0px;","*margin-top:0px;","margin-left:0px\\0;","margin-top:0px\\0;","filter: progid:DXImageTransform.Microsoft.Matrix(","M11="+t+",","M12=0,","M21=0,","M22="+t+",","SizingMethod='auto expand');"].join("")},i.prototype._bind=function(t){var n=this;p.on(this.panel,"click",function(t){var e=p.getTarget(t).getAttribute("drawingType");n.setStyleByDrawingMode(e),n._bindEventByDraingMode(e)})},i.prototype.setStyleByDrawingMode=function(t){if(t)for(var e=this.panel.getElementsByTagName("a"),n=0,i=e.length;n<i;n++){var o=e[n];if(o.getAttribute("drawingType")==t){var s="BMapLib_box BMapLib_"+t+"_hover";n==i-1&&(s+=" BMapLib_last"),o.className=s}else o.className=o.className.replace(/_hover/,"")}},i.prototype._bindEventByDraingMode=function(t){var e=this.drawingManager;"hander"==t?(e.close(),e._map.enableDoubleClickZoom()):(e.setDrawingMode(t),e.open(),e._map.disableDoubleClickZoom())};var n=[];function o(t){for(var e=n.length;e--;)n[e]!=t&&n[e].close()}}();BMapLib=window.BMapLib=BMapLib||{};var INFOBOX_AT_TOP=1,INFOBOX_AT_RIGHT=2,INFOBOX_AT_BOTTOM=3,INFOBOX_AT_LEFT=4;!function(){var t,e,p=t=p||{version:"1.5.0"};p.guid="$BAIDU$",window[p.guid]=window[p.guid]||{},p.lang=p.lang||{},p.lang.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},p.lang.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},p.lang.Event=function(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null},p.object=p.object||{},p.extend=p.object.extend=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},p.event=p.event||{},p.event._listeners=p.event._listeners||[],p.dom=p.dom||{},p.dom._g=function(t){return p.lang.isString(t)?document.getElementById(t):t},p._g=p.dom._g,p.event.on=function(e,t,n){t=t.replace(/^on/i,""),e=p.dom._g(e);var i,o=function(t){n.call(e,t)},s=p.event._listeners,a=p.event._eventFilter,r=t;return t=t.toLowerCase(),a&&a[t]&&(r=(i=a[t](e,t,o)).type,o=i.listener),e.addEventListener?e.addEventListener(r,o,!1):e.attachEvent&&e.attachEvent("on"+r,o),s[s.length]=[e,t,n,o,r],e},p.on=p.event.on,p.event.un=function(t,e,n){t=p.dom._g(t),e=e.replace(/^on/i,"").toLowerCase();for(var i,o,s,a=p.event._listeners,r=a.length,l=!n;r--;)(i=a[r])[1]!==e||i[0]!==t||!l&&i[2]!==n||(o=i[4],s=i[3],t.removeEventListener?t.removeEventListener(o,s,!1):t.detachEvent&&t.detachEvent("on"+o,s),a.splice(r,1));return t},p.un=p.event.un,p.dom.g=function(t){return"string"==typeof t||t instanceof String?document.getElementById(t):t&&t.nodeName&&(1==t.nodeType||9==t.nodeType)?t:null},p.g=p.G=p.dom.g,p.dom._styleFixer=p.dom._styleFixer||{},p.dom._styleFilter=p.dom._styleFilter||[],p.dom._styleFilter.filter=function(t,e,n){for(var i,o=0,s=p.dom._styleFilter;i=s[o];o++)(i=i[n])&&(e=i(t,e));return e},p.string=p.string||{},p.string.toCamelCase=function(t){return t.indexOf("-")<0&&t.indexOf("_")<0?t:t.replace(/[-_][^-_]/g,function(t){return t.charAt(1).toUpperCase()})},p.dom.setStyle=function(t,e,n){var i,o=p.dom;return t=o.g(t),e=p.string.toCamelCase(e),(i=o._styleFilter)&&(n=i.filter(e,n,"set")),(i=o._styleFixer[e])&&i.set?i.set(t,n):t.style[i||e]=n,t},p.setStyle=p.dom.setStyle,p.dom.setStyles=function(t,e){for(var n in t=p.dom.g(t),e)p.dom.setStyle(t,n,e[n]);return t},p.setStyles=p.dom.setStyles,p.browser=p.browser||{},p.browser.ie=p.ie=/msie (\d+\.\d+)/i.test(navigator.userAgent)?document.documentMode||+RegExp.$1:void 0,p.dom._NAME_ATTRS=(e={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",usemap:"useMap",frameborder:"frameBorder"},p.browser.ie<8?(e.for="htmlFor",e.class="className"):(e.htmlFor="for",e.className="class"),e),p.dom.setAttr=function(t,e,n){return t=p.dom.g(t),"style"==e?t.style.cssText=n:(e=p.dom._NAME_ATTRS[e]||e,t.setAttribute(e,n)),t},p.setAttr=p.dom.setAttr,p.dom.setAttrs=function(t,e){for(var n in t=p.dom.g(t),e)p.dom.setAttr(t,n,e[n]);return t},p.setAttrs=p.dom.setAttrs,p.dom.create=function(t,e){var n=document.createElement(t),i=e||{};return p.dom.setAttrs(n,i)},t.undope=!0;var n=BMapLib.InfoBox=function(t,e,n){this._content=e||"",this._isOpen=!1,this._map=t,this._opts=n=n||{},this._opts.offset=n.offset||new BMap.Size(0,0),this._opts.boxClass=n.boxClass||"infoBox",this._opts.boxStyle=n.boxStyle||{},this._opts.closeIconMargin=n.closeIconMargin||"2px",this._opts.closeIconUrl=n.closeIconUrl||"close.png",this._opts.enableAutoPan=!!n.enableAutoPan,this._opts.align=n.align||INFOBOX_AT_TOP};n.prototype=new BMap.Overlay,n.prototype.initialize=function(t){var e=this,n=this._div=p.dom.create("div",{class:this._opts.boxClass});p.dom.setStyles(n,this._opts.boxStyle),n.style.position="absolute",this._setContent(this._content);var i=t.getPanes().floatPane;return i.style.width="auto",i.appendChild(n),this._getInfoBoxSize(),p.event.on(n,"onmousedown",function(t){e._stopBubble(t)}),p.event.on(n,"onmouseover",function(t){e._stopBubble(t)}),p.event.on(n,"click",function(t){e._stopBubble(t)}),p.event.on(n,"dblclick",function(t){e._stopBubble(t)}),n},n.prototype.draw=function(){this._isOpen&&this._adjustPosition(this._point)},n.prototype.open=function(t){var e,n=this;this._isOpen||(this._map.addOverlay(this),this._isOpen=!0,setTimeout(function(){n._dispatchEvent(n,"open",{point:n._point})},10)),t instanceof BMap.Point?(e=t,this._removeMarkerEvt()):t instanceof BMap.Marker&&(this._marker&&this._removeMarkerEvt(),e=t.getPosition(),this._marker=t,!this._markerDragend&&this._marker.addEventListener("dragend",this._markerDragend=function(t){n._point=t.point,n._adjustPosition(n._point),n._panBox(),n.show()}),!this._markerDragging&&this._marker.addEventListener("dragging",this._markerDragging=function(){n.hide(),n._point=n._marker.getPosition(),n._adjustPosition(n._point)})),this.show(),this._point=e,this._panBox(),this._adjustPosition(this._point)},n.prototype.close=function(){this._isOpen&&(this._map.removeOverlay(this),this._remove(),this._isOpen=!1,this._dispatchEvent(this,"close",{point:this._point}))},n.prototype.enableAutoPan=function(){this._opts.enableAutoPan=!0},n.prototype.disableAutoPan=function(){this._opts.enableAutoPan=!1},n.prototype.setContent=function(t){this._setContent(t),this._getInfoBoxSize(),this._adjustPosition(this._point)},n.prototype.setPosition=function(t){this._point=t,this._adjustPosition(t),this._removeMarkerEvt()},n.prototype.getPosition=function(){return this._point},n.prototype.getOffset=function(){return this._opts.offset},n.prototype._remove=function(){this.domElement&&this.domElement.parentNode&&(p.event.un(this._div.firstChild,"click",this._closeHandler()),this.domElement.parentNode.removeChild(this.domElement)),this.domElement=null,this._isOpen=!1,this.dispatchEvent("onremove")},p.object.extend(n.prototype,{_getCloseIcon:function(){return"<img src='"+this._opts.closeIconUrl+"' align='right' style='position:absolute;right:0px;cursor:pointer;margin:"+this._opts.closeIconMargin+"'/>"},_setContent:function(t){if(this._div){var e=this._getCloseIcon();void 0===t.nodeType?this._div.innerHTML=e+t:(this._div.innerHTML=e,this._div.appendChild(t)),this._content=t,this._addEventToClose()}},_adjustPosition:function(t){var e=this._getPointPosition(t),n=this._marker&&this._marker.getIcon();switch(this._opts.align){case INFOBOX_AT_TOP:this._marker?this._div.style.bottom=-(e.y-this._opts.offset.height-n.anchor.height+n.infoWindowAnchor.height)-this._marker.getOffset().height+2+"px":this._div.style.bottom=-(e.y-this._opts.offset.height)+"px";break;case INFOBOX_AT_BOTTOM:this._marker?this._div.style.top=e.y+this._opts.offset.height-n.anchor.height+n.infoWindowAnchor.height+this._marker.getOffset().height+"px":this._div.style.top=e.y+this._opts.offset.height+"px"}this._marker?this._div.style.left=e.x-n.anchor.width+this._marker.getOffset().width+n.infoWindowAnchor.width-this._boxWidth/2+"px":this._div.style.left=e.x-this._boxWidth/2+"px"},_getPointPosition:function(t){return this._pointPosition=this._map.pointToOverlayPixel(t),this._pointPosition},_getInfoBoxSize:function(){this._boxWidth=parseInt(this._div.offsetWidth,10),this._boxHeight=parseInt(this._div.offsetHeight,10)},_addEventToClose:function(){p.event.on(this._div.firstChild,"click",this._closeHandler()),this._hasBindEventClose=!0},_closeHandler:function(){var e=this;return function(t){e.close()}},_stopBubble:function(t){t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0},_panBox:function(){if(this._opts.enableAutoPan){var t=parseInt(this._map.getContainer().offsetHeight,10),e=parseInt(this._map.getContainer().offsetWidth,10),n=this._boxHeight,i=this._boxWidth;if(!(t<=n||e<=i)){this._map.getBounds().containsPoint(this._point)||this._map.setCenter(this._point);var o,s,a,r=this._map.pointToPixel(this._point),l=i/2-r.x,p=i/2+r.x-e;if(this._marker)var h=this._marker.getIcon();switch(this._opts.align){case INFOBOX_AT_TOP:var _=this._marker?h.anchor.height+this._marker.getOffset().height-h.infoWindowAnchor.height:0;o=n-r.y+this._opts.offset.height+_+2;break;case INFOBOX_AT_BOTTOM:_=this._marker?-h.anchor.height+h.infoWindowAnchor.height+this._marker.getOffset().height+this._opts.offset.height:0;s=n+r.y-t+_+4}panX=0<l?l:0<p?-p:0,a=0<o?o:0<s?-s:0,this._map.panBy(panX,a)}}},_removeMarkerEvt:function(){this._markerDragend&&this._marker.removeEventListener("dragend",this._markerDragend),this._markerDragging&&this._marker.removeEventListener("dragging",this._markerDragging),this._markerDragend=this._markerDragging=null},_dispatchEvent:function(t,e,n){0!=e.indexOf("on")&&(e="on"+e);var i=new p.lang.Event(e);if(n)for(var o in n)i[o]=n[o];t.dispatchEvent(i)}})}();